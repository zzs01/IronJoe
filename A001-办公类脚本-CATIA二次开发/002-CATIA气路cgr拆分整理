Sub CATMain()
'''''''''''''''''
'CATIA气路cgr拆分整理
'1.拆分VLV
'
'待完善
'1.保存
'2.排序
'3.自动打开处理后关闭，批量处理
''''''''''''''''
Set productDocument1 = CATIA.ActiveDocument

Dim product1 As Product
Set product1 = productDocument1.Product

Dim products1 As Products
Set products1 = product1.Products

Dim dic As Object
Set dic = CreateObject("scripting.dictionary")

Dim productCut As Product
Dim partNumber As String
Dim splitText As String
Dim arr As Variant
Dim VLVText As String

Dim i As Integer
'气路拆分比较
For i = products1.Count To 1 Step -1
    Set productCut = products1.Item(i)
    productCut.Name = productCut.partNumber & ".1"
    
    partNumber = UCase(productCut.partNumber)
    If InStr(partNumber, "CYL") <> 0 Then
        arr = Split(partNumber, "_")
        splitText = arr(UBound(arr))
        If Len(splitText) > 5 Then
            VLVText = "VLV" & Mid$(splitText, 4, 2)
        Else
            VLVText = "VLV0" & Mid$(splitText, 4, 1)
        End If
    Else
        VLVText = "FIX"
    End If
    
    '字典判断是否已存在
    If Not dic.Exists(VLVText) Then
        dic.Add VLVText, VLVText & ".1"
        Dim productVLV As Product
        Set productVLV = products1.AddNewProduct(VLVText)
    End If
    
    '粘贴板的剪切处理
    Dim selection2
    Set selection2 = productDocument1.Selection
    selection2.Clear
    
    selection2.Add productCut
    selection2.Cut
    
    '粘贴板的粘贴处理
    Dim selection3
    Set selection3 = productDocument1.Selection
    selection3.Clear
    
    Dim productPaste As Product
    Set productPaste = products1.GetItem(dic(VLVText))
    
    selection3.Add productPaste
    selection3.Paste
    
Next i

MsgBox "程序运行结束，请检查，谢谢！"


End Sub

        
